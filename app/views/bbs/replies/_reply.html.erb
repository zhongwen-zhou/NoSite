<% cache([reply,"raw:#{@show_raw}"]) do %>
<%
  floor = reply_counter + 1 + ((@page - 1) * ::Bbs::Reply.per_page)
%>
<div class="reply<%= ' popular' if reply.popular? %>" id="reply<%= floor %>">
  <% if reply.deleted? and !@show_raw %>
    <div class="deleted"><%= floor %><%= t("common.floor")%> 已删除.</div>
  <% else %>
    <div class="pull-left face">
      <% if reply.user.league %>
        <%= image_tag(reply.user.league.logo_url) %>
      <% else %>
        <%= user_avatar_tag(reply.user, :normal) %>
      <% end %>
    </div>
    <div class="infos">
      <div class="info">
        <span class="name">
          <%= user_name_tag(reply.user) %>

          <%= link_to '交流', start_message_communications_path(:user_id => reply.user_id), :target => :black if reply.user != current_user %>
        </span>
        <span class="time">
          <a class="reply-floor" href="#reply<%= floor %>"><%= floor %><%= t("common.floor")%></a>
          ,
          <%= timeago(reply.created_at) %>
        </span>
        <span class="opts">
          <% if !reply.deleted? %>
            <%= likeable_tag(reply, :cache => true) %>
            <%= link_to("", edit_bbs_topic_reply_path(@topic,reply), :class => "edit icon small_edit", 'data-uid' => reply.user_id, :title => "修改回帖")%>
            <%= link_to("", "#", 'data-floor' => floor, 'data-login' => reply.user_login,
                :title => t("topics.reply_this_floor"), :class => "icon small_reply" )
            %>
          <% end %>
        </span>
      </div>
      <div class="body<%= ' deleted' if reply.deleted? %>">
        <%= raw reply.body_html %>
      </div>
      <span class="opts">
      </span>
      <div>
          <% reply.user.badge_winners.each do |badge_winner| %>
            <%= image_tag(badge_winner.badge.photo_url, :width => 50, :height => 50) %>
          <% end %>
      </div>
    </div>
  <% end %>
</div>
<% end %>

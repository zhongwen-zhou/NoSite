<style type="text/css">
  .league-logo-img {
    max-width: 120px;
    max-height: 120px;
  }
</style>


<br/>
<%= render('ads/ad_hf_01') %>
<br/>
<!-- Nav tabs -->
<% if current_user && current_user.league %>
  <div class="row">
    <% if ((@league != current_user.league) && (current_user.league.president_id == current_user.id)) %>
    <a href="javascript: void(0);" data-role='proclaim-war-btn' class="btn btn-danger" style="margin-left: 70%">向他们宣战！</a>
    <% end %>
    <%= link_to '向他们宣战！', proclaim_war_league_league_path(@league), :remote => true, :style => 'display: none;', :id => 'real_proclaim_btn' %>
  </div>
<% end %>
<div class="row">
  <div class="col-md-2 col-md-offset-1">
    <ul id="leagueTab" class="nav nav-stacked nav-pills">
      <li><a href="#info" data-toggle="tab">基本信息</a></li>
      <li><a href="#messages" data-toggle="tab">成员</a></li>
    </ul>
  </div>
  <div class="col-md-8 col-md-offset-1">
    <!-- Tab panes -->
    <div class="tab-content">
      <div class="tab-pane active" id="info">
        <% if league = @league %>
          <div>
            <%= image_tag(league.logo_url, :class => 'league-logo-img') %>
            <%= link_to league.name, league_league_path(league) %><br/>
            工会等级：<%= league.level %><br/>
            工会帮主：<%= link_to league.president_name, user_path(league.president) %><br>
            工会副帮主：<%= link_to league.president_name, user_path(league.president) %><br>
            帮众数量：<%= league.members_count %><br/>
            工会宣言：<%= league.declaration %>
          </div>
        <% else %>
          还没有加入任何工会的自由人！
        <% end %>
      </div>
      <div class="tab-pane" id="messages">
        <ul>
          <% @league.members.each do |member| %>
            <li>
              <%= link_to member.user.name, user_path(member.user) %>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</div>


<% content_for :scripts do %>
  <script type="text/javascript">
    $(document).ready(function(){
      <% if ((@league != current_user.league) && (current_user.league.president_id == current_user.id)) %>

      $('[data-role=proclaim-war-btn]').click(function(){
        var my_level = <%= current_user.league.level %>;
        var your_level = <%= @league.level %>;
        if(my_level < 4){
          bootbox.alert('您的工会没有达到4级，不能宣战！');
        }else{
          if(your_level < 3){
            bootbox.alert('该工会没有达到3级，不能对其宣战！');
          }else{
            $('#real_proclaim_btn').click();
          }
        }
      });
      <% end %>
      $('#leagueTab').tab();
    });
  </script>
<% end %>